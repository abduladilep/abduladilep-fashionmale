<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Male_Fashion Template">
    <meta name="keywords" content="Male_Fashion, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Male-Fashion | Template</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&display=swap"
        rel="stylesheet">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
     integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
 
 

    <!-- Css Styles -->
    <link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="/css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="/css/magnific-popup.css" type="text/css">
    <link rel="stylesheet" href="/css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="/css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="/css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
    <!-- Page Preloder -->
    <!-- <div id="preloder">
        <div class="loader"></div>
    </div> -->

    <!-- Offcanvas Menu Begin -->
    <div class="offcanvas-menu-overlay"></div>
    <div class="offcanvas-menu-wrapper">
        <div class="offcanvas__option">
            <div class="header__top__links">
                
                    <a href="/Logout">Logout</a>
                    
                       
                        
                        <a href="#">FAQs</a>
                    </div>
            <div class="offcanvas__top__hover">
                <span>Usd <i class="arrow_carrot-down"></i></span>
                <ul>
                    <li>USD</li>
                    <li>EUR</li>
                    <li>USD</li>
                </ul>
            </div>
        </div>
        <div class="offcanvas__nav__option">
            <a href="#" class="search-switch"><img src="img/icon/search.png" alt=""></a>
            <a href="#"><img src="img/icon/heart.png" alt=""></a>
            <a href="#"><img src="img/icon/cart.png" alt=""> <span>0</span></a>
           
        </div>
        <div id="mobile-menu-wrap"></div>
        <div class="offcanvas__text">
            <p>Free shipping, 30-day return or refund guarantee.</p>
        </div>
    </div>
    <!-- Offcanvas Menu End -->

    <!-- Header Section Begin -->
    <header class="header">
        <div class="header__top">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6 col-md-7">
                        <div class="header__top__left">
                            <p>Free shipping, 30-day return or refund guarantee.</p>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-5">
                        <div class="header__top__right">
                            <div class="header__top__links">
                                <% if(userId){%>
                                    <a href="/Logout">Logout</a>
                                    <%}
                                    else{%>
                                        <a href="/signin">Sign in</a>
                                        <%} %>
                                        
                                    </div>
                                   
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-3">
                    <div class="header__logo">
                        <a href="./index.html"><img src="img/logo.png" alt=""></a>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6">
                    <nav class="header__menu mobile-menu">
                        <ul>
                            <li class="active"><a href="/">Home</a></li>
                            <li><a href="/shop">Shop</a></li>
                          
                                
                            </li>
                            <li><a href="/myaccount">Account</a></li>
                            <li><a href="/contact">Contacts</a></li>
                        </ul>
                    </nav>
                </div>
                <div class="col-lg-3 col-md-3">
                    <div class="header__nav__option">
                        <a href="#" class="search-switch"><img src="img/icon/search.png" alt=""></a>
                        <a href="#"><img src="img/icon/heart.png" alt=""></a>
                        <a href="#"><img src="img/icon/cart.png" alt=""> <span></span></a>

                    </div>
                </div>
            </div>
            <div class="canvas__open"><i class="fa fa-bars"></i></div>
        </div>
    </header>
    <!-- Header Section End -->

    <!-- Breadcrumb Section Begin -->
    <section class="breadcrumb-option">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb__text">
                        <h4>Check Out</h4>
                        <div class="breadcrumb__links">
                            <a href="./index.html">Home</a>
                            <a href="./shop.html">Shop</a>
                            <span>Check Out</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Breadcrumb Section End -->

    <!-- Checkout Section Begin -->
    <section class="checkout spad">
        <div class="container">
            <div class="checkout__form">
                <form id="pay" method="post" >
                   
<% if(cartList.length >0) {%>
                    <input type="hidden" value="<%= cartList[0]._id %>" name="cartId">
                    <%} else{%>
                      
                            <%}%>
                        </div>
                  
                     
                    
                    <div class="row">
                        <div class="col-lg-8 col-md-6">


                            <div class="cart__discount">
                                <h6>Discount codes</h6>
        
        
                                <input type="text" placeholder="Coupon code" id="usercode" name="usercode">
                                <button class="btn btn-primart" type="button" id="button" onclick="coupen()">Apply</button>
        
                            </div>
                            <!-- <div class="btn btn-dark"><a href="/addAddress"> ADD NEW ADRESS </a></div> -->
                            <h6 class="coupon__code"><span class="icon_tag_alt"></span> Add New Address? <a href="/addAddress">Click
                                    here</a> add new address</h6>
                            <h6 class="checkout__title">Billing Details</h6>
                            <div class="row">

                                <table class="table custom-table" style="background-color: #F3F2EE;">


                                    <thead>
                                        <tr>

                                            <th></th>
                                            <th>Address</th>
                                            <th></th>
                                            <th>Delete</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% let i=0; for(add of useraddress) { %>
                                            <tr>
                 

                                                <th>
                                                    <label class="control control--checkbox">
                                                        <input type="radio" value=" <%= add.Firstname%><%=add.Lastname%>,<%=add.street%>,<%=add.houseNo%>,<%=add.district%>,<%=add.state%>,<%=add.pincode%>,<%=add.Email%>,<%=add.mobile%>" name="address"
                                                            <%if(i===0) {%>
                                                        checked<% } %>


                                                            <div class="control_indicator"></div>
                                                    </label>
                                                </th>

                                                <td>
                                                    <h5 style="font-weight:bolder">
                                                        <%= add.Firstname +" "+add.Lastname %>

                                                    </h5>
                                                    <p>
                                                        <%= add.street +" , "+ add.houseNo +", "+add.state +", "+add.district+" ,"+add.pincode%>

                                                    </p>
                                                    <p>
                                                        <%=add.Email +", "+add.mobile %>
                                                    </p>
                                                         
                                                </td>
                                                
                                                   <td></td>

                                                    <td>
                                                        <button class="btn btn-danger rounded m-3 " data-bs-toggle="modal"
                                                        data-bs-target="#exampleModal<%= add._id %>" type="button">Delete</button>
                        
                        
                                                        </td>
                                             
                                            </tr>
                                            <%i++}%>
                                    </tbody>
                                </table>


                            </div>


                        </div>
                        
                        <div class="col-lg-4 col-md-6">
                            <div class="checkout__order">
                                <h4 class="order__title">Your order</h4>
                                <div class="checkout__order__products">Product <span>Total</span></div>
                                <% cartList.forEach((p)=>{%>
                                    <% p.product.forEach((p2)=>{%>
                                        <ul class="checkout__total__products">


                                            <% const total=parseInt(p2.product_price)*parseInt(p.itemQuantity) %>
                                                <li>
                                                    <%=p2.product_name %> <span>
                                                            <%= total %>
                                                        </span>
                                                </li>


                                        </ul>
                                        <% }) %>


                                            <% }) %>

                                                <ul class="checkout__total__all">
                                                    <li>Subtotal <span id="subtotal">
                                                            <%= subtotal %>
                                                        </span></li>
                                                    <li>shipping <span id="subtotal">
                                                            <%= shipping %>
                                                        </span></li>
                                                  
                                                        <li>Discount<span id="discount">0</span>
                                                        
                                                    </span></li>


                                                    <li>Total <span id="grandtotal">
                                                            <%= grandtotal %>
                                                        </span></li>
                                                </ul>


                                                
                                                
                                                <div class="checkout__input__checkbox">
                                                    <label for="payment">
                                                        COD
                                                        <input type="radio" id="payment"  value="cod" name="payment">
                                                        <span class="checkmark"></span>
                                                    </label>
                                                </div>
                                                <div class="checkout__input__checkbox">
                                                    <label for="paypal">
                                                        Razorpay
                                                        <input type="radio" id="paypal" value="Online" name="payment">
                                                        <span class="checkmark"></span>
                                                    </label>
                                                </div>

                                                <button type="submit" id="order" class="site-btn">PLACE ORDER</button>
                           
                                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </section>
    <!-- Checkout Section End -->

    <!-- Footer Section Begin -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div class="footer__about">
                        <div class="footer__logo">
                            <a href="#"><img src="img/footer-logo.png" alt=""></a>
                        </div>
                        <p>The customer is at the heart of our unique business model, which includes design.</p>
                        <a href="#"><img src="img/payment.png" alt=""></a>
                    </div>
                </div>
                <div class="col-lg-2 offset-lg-1 col-md-3 col-sm-6">
                    <div class="footer__widget">
                        <h6>Shopping</h6>
                        <ul>
                            <li><a href="#">Clothing Store</a></li>
                            <li><a href="#">Trending Shoes</a></li>
                            <li><a href="#">Accessories</a></li>
                            <li><a href="#">Sale</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6">
                    <div class="footer__widget">
                        <h6>Shopping</h6>
                        <ul>
                            <li><a href="#">Contact Us</a></li>
                            <li><a href="#">Payment Methods</a></li>
                            <li><a href="#">Delivary</a></li>
                            <li><a href="#">Return & Exchanges</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-3 offset-lg-1 col-md-6 col-sm-6">
                    <div class="footer__widget">
                        <h6>NewLetter</h6>
                        <div class="footer__newslatter">
                            <p>Be the first to know about new arrivals, look books, sales & promos!</p>
                            <form action="#">
                                <input type="text" placeholder="Your email">
                                <!-- <button type="submit"><span class="icon_mail_alt"></span></button> -->
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12 text-center">
                    <div class="footer__copyright__text">
                        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                        <p>Copyright ©
                            <script>
                                document.write(new Date().getFullYear());
                            </script>2020
                            All rights reserved | This template is made with <i class="fa fa-heart-o"
                                aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
                        </p>
                        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- Footer Section End -->

    <% for(let add of useraddress) { %>

        <div class="modal fade" id="exampleModal<%= add._id %>" tabindex="-1" role="dialog"
            aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Remove Address</h5>
                        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        Do you want remove this Address ..?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" onclick="deleteAddress('<%= add._id %>')" class="btn btn-danger"
                            data-dismiss="modal">Delete</button>
                    </div>
                </div>
            </div>
        </div>
        <% } %>

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
       

        $("#pay").submit((e) => { 
           

            e.preventDefault()
            let total = document.getElementById('grandtotal').innerHTML
total=parseInt(total)

            $.ajax({
                url: '/checkout/placeOrder/'+total,
                method: 'post',
                data:$("#pay").serialize(),
                success: (response) => {
                    if (response.codSuccess) {
                        location.href = '/checkout/orderSuccess'
                    } else {
                        razorpayPayment(response.response,response.orderId)
                    }
                }
            })
        })
        function razorpayPayment(order,orderId) {

       
            console.log("ggggg",order,orderId);
            var options = {
                "key": "rzp_test_DftcNjVgIfTLh3", // Enter the Key ID generated from the Dashboard
                "amount": 45454, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                "currency": "INR",
                "name": "E-COMMERCE",
                "description": "Test Transaction",
                "image": "https://example.com/your_logo",
                "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
                "handler": function (response) {
                    console.log(response);

                    verifyPayment(response, order,orderId)
                },
                "prefill": {
                    "name": "Gaurav Kumar",
                    "email": "gaurav.kumar@example.com",
                    "contact": "9999999999"
                },
                "notes": {
                    "address": "Razorpay Corporate Office"
                },
                "theme": {
                    "color": "#3399cc"
                }
            };
            var rzp1 = new Razorpay(options)
            rzp1.open();
        }
        function verifyPayment(payment, order,orderId) {
            console.log("sh",payment,order);
            $.ajax({
                url: '/checkout/verifyPay',
                data: {
                    payment,
                    order,
                    orderId
                },
                method: 'post',
                success: (response) => {
                    if (response.status) {
                        location.href = '/checkout/orderSuccess'
                    } else {
                        alert("Payment failed")
                    }
                }
            })
        }
    // </script>



<script>


function coupen() {

    const usercode = document.getElementById('usercode').value
    console.log("usercode", usercode);
    let disc = document.getElementById('discount').innerHTML
    
    fetch('/admin/applyCoupen/' + usercode, {
        method: 'post',
        headers: {
            'Content-Type': 'application/json',
            
            
        },
        body: JSON.stringify({ disc })
        
    })
    .then(res => res.json())
    .then(data => {
        console.log("daaataa",data);
        discount = data.success
        console.log(discount,"discount");
        ;
        if (parseInt(document.getElementById('grandtotal').innerHTML) > 15000) {

            

                if (parseInt(document.getElementById('discount').innerHTML) > 0) {
                    
                    document.getElementById('button').disabled = true
                } else {

console.log("svssad",(parseInt(document.getElementById('grandtotal').innerHTML)));
console.log("gffff",discount.minAmount);

                    if(parseInt(document.getElementById('grandtotal').innerHTML)>discount.minAmount){
                      
                        

                        coupen  =5000                      
                    }else{

                        coupen = Math.round(document.getElementById('grandtotal').innerHTML * (discount.discountPercentage / 100))
                    }
                    



                    document.getElementById('discount').innerHTML = coupen
                    document.getElementById('grandtotal').innerHTML = parseInt(document.getElementById('grandtotal').innerHTML) - parseInt(coupen)

                  
                }
            }
            else if (parseInt(document.getElementById('grandtotal').innerHTML) < 15000) {
                document.getElementById('discount').innerHTML = '0'
            }
        })
}


</script>
<script>

function deleteAddress(id) {
    console.log("innnnnn",id);
    fetch('/deleteAddress/' + id, {
        method: 'delete',
        headers: {
            'Content-Type': 'application/json',
            body: JSON.stringify({ hai: "jhj" })
        }
    })
        .then(res => res.json())
        .then(data => {
            success: location.reload()
        })
}


</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
crossorigin="anonymous"></script> 

    <!-- Js Plugins -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <script src="js/jquery.nicescroll.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/jquery.countdown.min.js"></script>
    <script src="js/jquery.slicknav.js"></script>
    <script src="js/mixitup.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/main.js"></script>
</body>

</html>